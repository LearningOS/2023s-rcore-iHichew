<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Implementation of process [`ProcessControlBlock`] and task(thread) [`TaskControlBlock`] management mechanism"><meta name="keywords" content="rust, rustlang, rust-lang, task"><title>os::task - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../os/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../os/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module task</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../os/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press â€˜Sâ€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">os</a>::<wbr><a class="mod" href="#">task</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/os/task/mod.rs.html#1-206">source</a> Â· <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Implementation of process <a href="process/struct.ProcessControlBlock.html" title="ProcessControlBlock"><code>ProcessControlBlock</code></a> and task(thread) <a href="task/struct.TaskControlBlock.html" title="TaskControlBlock"><code>TaskControlBlock</code></a> management mechanism</p>
<p>Here is the entry for task scheduling required by other modules
(such as syscall or clock interrupt).
By suspending or exiting the current task, you can
modify the task state, manage the task queue through TASK_MANAGER (in task/manager.rs) ,
and switch the control flow through PROCESSOR (in task/processor.rs) .</p>
<p>Be careful when you see <a href="switch/fn.__switch.html" title="__switch"><code>__switch</code></a>. Control flow around this function
might not be what you expect.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="context/index.html" title="os::task::context mod">context</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>Implementation of <a href="context/struct.TaskContext.html" title="TaskContext"><code>TaskContext</code></a></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="id/index.html" title="os::task::id mod">id</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>Allocator for pid, task user resource, kernel stack using a simple recycle strategy.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="manager/index.html" title="os::task::manager mod">manager</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>Implementation of <a href="manager/struct.TaskManager.html" title="TaskManager"><code>TaskManager</code></a></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="process/index.html" title="os::task::process mod">process</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>Implementation of  <a href="process/struct.ProcessControlBlock.html" title="ProcessControlBlock"><code>ProcessControlBlock</code></a></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="processor/index.html" title="os::task::processor mod">processor</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>Implementation of <a href="processor/struct.Processor.html" title="Processor"><code>Processor</code></a> and Intersection of control flow</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="signal/index.html" title="os::task::signal mod">signal</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>Signal flags and function for convert signal flag to integer &amp; string</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="switch/index.html" title="os::task::switch mod">switch</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>provides __switch asm function to switch between two task contexts  <a href="context/struct.TaskContext.html" title="TaskContext"><code>TaskContext</code></a></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="task/index.html" title="os::task::task mod">task</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="item-right docblock-short"><p>Types related to task management &amp; Functions for completely changing TCB</p>
</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.INITPROC.html" title="os::task::INITPROC struct">INITPROC</a></div><div class="item-right docblock-short"><p>Creation of initial process</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.KernelStack.html" title="os::task::KernelStack struct">KernelStack</a></div><div class="item-right docblock-short"><p>Kernel stack for a task</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PidHandle.html" title="os::task::PidHandle struct">PidHandle</a></div><div class="item-right docblock-short"><p>A handle to a pid</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SignalFlags.html" title="os::task::SignalFlags struct">SignalFlags</a></div><div class="item-right docblock-short"><p>Signal flags</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TaskContext.html" title="os::task::TaskContext struct">TaskContext</a></div><div class="item-right docblock-short"><p>task context structure containing some registers</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TaskControlBlock.html" title="os::task::TaskControlBlock struct">TaskControlBlock</a></div><div class="item-right docblock-short"><p>Task control block structure</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TaskStatus.html" title="os::task::TaskStatus enum">TaskStatus</a></div><div class="item-right docblock-short"><p>The execution status of the current process</p>
</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.IDLE_PID.html" title="os::task::IDLE_PID constant">IDLE_PID</a></div><div class="item-right docblock-short"><p>The idle taskâ€™s pid is 0</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.add_initproc.html" title="os::task::add_initproc fn">add_initproc</a></div><div class="item-right docblock-short"><p>Add init process to the manager</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.add_task.html" title="os::task::add_task fn">add_task</a></div><div class="item-right docblock-short"><p>Add a task to ready queue</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.block_current_and_run_next.html" title="os::task::block_current_and_run_next fn">block_current_and_run_next</a></div><div class="item-right docblock-short"><p>Make current task blocked and switch to the next task.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.check_signals_of_current.html" title="os::task::check_signals_of_current fn">check_signals_of_current</a></div><div class="item-right docblock-short"><p>Check if the current task has any signal to handle</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.current_add_signal.html" title="os::task::current_add_signal fn">current_add_signal</a></div><div class="item-right docblock-short"><p>Add signal to the current task</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.current_kstack_top.html" title="os::task::current_kstack_top fn">current_kstack_top</a></div><div class="item-right docblock-short"><p>get the top addr of kernel stack</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.current_process.html" title="os::task::current_process fn">current_process</a></div><div class="item-right docblock-short"><p>get current process</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.current_task.html" title="os::task::current_task fn">current_task</a></div><div class="item-right docblock-short"><p>Get a copy of the current task</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.current_trap_cx.html" title="os::task::current_trap_cx fn">current_trap_cx</a></div><div class="item-right docblock-short"><p>Get the mutable reference to trap context of current task</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.current_trap_cx_user_va.html" title="os::task::current_trap_cx_user_va fn">current_trap_cx_user_va</a></div><div class="item-right docblock-short"><p>get the user virtual address of trap context</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.current_user_token.html" title="os::task::current_user_token fn">current_user_token</a></div><div class="item-right docblock-short"><p>Get the current user token(addr of page table)</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.exit_current_and_run_next.html" title="os::task::exit_current_and_run_next fn">exit_current_and_run_next</a></div><div class="item-right docblock-short"><p>Exit the current â€˜Runningâ€™ task and run the next task in task list.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.kstack_alloc.html" title="os::task::kstack_alloc fn">kstack_alloc</a></div><div class="item-right docblock-short"><p>Allocate a kernel stack for a task</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.pid2process.html" title="os::task::pid2process fn">pid2process</a></div><div class="item-right docblock-short"><p>Get process by pid</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.pid_alloc.html" title="os::task::pid_alloc fn">pid_alloc</a></div><div class="item-right docblock-short"><p>Allocate a pid for a process</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.remove_from_pid2process.html" title="os::task::remove_from_pid2process fn">remove_from_pid2process</a></div><div class="item-right docblock-short"><p>Remove item(pid, _some_pcb) from PDI2PCB map (called by exit_current_and_run_next)</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.remove_inactive_task.html" title="os::task::remove_inactive_task fn">remove_inactive_task</a></div><div class="item-right docblock-short"><p>the inactive(blocked) tasks are removed when the PCB is deallocated.(called by exit_current_and_run_next)</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.remove_task.html" title="os::task::remove_task fn">remove_task</a></div><div class="item-right docblock-short"><p>Remove a task from the ready queue</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.run_tasks.html" title="os::task::run_tasks fn">run_tasks</a></div><div class="item-right docblock-short"><p>The main part of process execution and scheduling
Loop <code>fetch_task</code> to get the process that needs to run, and switch the process through <code>__switch</code></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.schedule.html" title="os::task::schedule fn">schedule</a></div><div class="item-right docblock-short"><p>Return to idle control flow for new scheduling</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.suspend_current_and_run_next.html" title="os::task::suspend_current_and_run_next fn">suspend_current_and_run_next</a></div><div class="item-right docblock-short"><p>Make current task suspended and switch to the next task</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.take_current_task.html" title="os::task::take_current_task fn">take_current_task</a></div><div class="item-right docblock-short"><p>Get current task through take, leaving a None in its place</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.wakeup_task.html" title="os::task::wakeup_task fn">wakeup_task</a></div><div class="item-right docblock-short"><p>Wake up a task</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="os" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0-nightly (f6f9d5e73 2022-08-04)" ></div></body></html>